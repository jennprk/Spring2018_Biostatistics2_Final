---
title: "Biostat_proj_q2"
author: "Jieun Park & Satmeer Bains"
date: "3/28/2018"
output: pdf_document
---

# Build a model to predict whether a patient will receive RHC as a function of all pre-RHCvariables.   Comment  on  the  interpretation  of  the  coefficients  of  this  model.   Comment  on potential issues regarding confounding of the effect of RHC on clinical outcomes in this study. 

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(ggplot2)
library(data.table)
library(lmtest)
library(sandwich)
```

## Create and manipulate data for use

```{r}
data <- read.csv('/Users/jieun/Desktop/Biostat2/rhc.csv')
#loading the data
View(data)
#no of comorbid illnesses
data$no_comorbid <- data$cardiohx + data$chfhx + data$dementhx + data$psychhx + data$chrpulhx + data$renalhx + data$liverhx + data$gibledhx + data$malighx + data$immunhx + data$transhx + data$amihx 

#selecting variables only mentioned in Table 1 but not adl as most values are missing
data = subset(data, select = c(age,sex,race,death,edu,income,ninsclas,cat1,ca,dnr1,aps1,surv2md1,no_comorbid,das2d3pc,temp1,hrt1,meanbp1,resp1,wblc1,wblc1,paco21,ph1,sod1,pot1,hema1,bili1,crea1,alb1,scoma1,swang1))

#renaming columns
colnames(data) <- c("age", "sex","race","death","education","income","medical_insurance","primary_disease_cat","cancer","dnr","apache","prob_2mo_survival","no_comorbid","dasi","temp","heart_rate","blood_pressure","resp_rate","wbc","PaO2_FIO2","PaCo2","ph","sodium","potassium","hematocrit","bilirubin","creatinine","albumin","glasgow_coma","rch")

#creatiing age group
setDT(data)[age <50, agegroup := "<50"]
data[age >=50 & age <60, agegroup := "50 to <60"]
data[age >=60 & age <70, agegroup := "60 to <70"]
data[age >=70 & age <80, agegroup := "70 to <80"]
data[age >=80, agegroup := ">=80"]

#creating disease category
setDT(data)[primary_disease_cat=="ARF", primary_dis_cat := "ARF"]
data[primary_disease_cat=="MOSF w/Malignancy" | primary_disease_cat=="MOSF w/Sepsis", primary_dis_cat := "MOSF"]
data[primary_disease_cat=="CHF", primary_dis_cat := "CHF"]
data[primary_disease_cat=="Cirrhosis" |primary_disease_cat=="Colon Cancer" |primary_disease_cat=="Coma" |primary_disease_cat=="COPD" |primary_disease_cat=="Lung Cancer", primary_dis_cat := "Other"]

#removing age and primary_disease
data = subset(data, select = -c(primary_disease_cat))

data=data[complete.cases(data)]

data$death <- as.factor(ifelse(data$death == "Yes", 1, 0))
```

```{r}
# Model
names(data)
fit <- glm(rch ~ age + sex + race + education + income + medical_insurance + blood_pressure+heart_rate+resp_rate+ph+PaO2_FIO2+PaCo2+primary_dis_cat, data = data, family = binomial)
summary(fit)
# odds ratios
exp(coef(summary(fit)))

```

(needs adding and changing)

Through logistic regression, we aim to predict whether a patient will receive RHC as a function of all pre-RHC variables which are included in the model. 

If we start with blood pressure, the coefficient is -0.0102725, which is interpreted as the expected change in log odds for a one-unit increase in the blood pressure. We can say that for a one unit increase in blood pressure, the odds of receiving RHC increase by a factor of 0.9897800. 

For heart rate, the coefficient is 0.0053856, which is interpreted as the expected change in log odds for a one-unit increase in the heart rate. We can say that for a one unit increase in heart rate, the odds of receiving RHC increase by a factor of 1.0054. 

For respiratory rate, the coefficient is -0.0202579 , which is interpreted as the expected change in log odds for a one-unit increase in the respiratory rate. We can say that for a one unit increase in respiratory rate, the odds of receiving RHC increase by a factor of 0.9799459. 

For blood pH, the coefficient is  -2.0302448, which is interpreted as the expected change in log odds for a one-unit increase in the blood pH. We can say that for a one unit increase in blood pH, the odds of receiving RHC increase by a factor of 0.13. 

For PaO2_FIO2, the coefficient is  0.0037786, which is interpreted as the expected change in log odds for a one-unit increase in the PaO2_FIO2. We can say that for a one unit increase in PaO2_FIO2, the odds of receiving RHC increase by a factor of 1.003.  

For PaCo2, the coefficient is  -0.0221156, which is interpreted as the expected change in log odds for a one-unit increase in the PaCo2. We can say that for a one unit increase in PaCo2, the odds of receiving RHC increase by a factor of 1.7.  

For primary disease category of CHF, the coefficient is 0.5281750, which is interpreted as the expected change in log odds for a one-unit increase in the CHF. We can say that for a one unit increase in CHF, the odds of receiving RHC increase by a factor of 1.7.

For primary disease category of MOSF, the coefficient is 0.4632045, which is interpreted as the expected change in log odds for a one-unit increase in the MOSF. We can say that for a one unit increase in MOSF, the odds of receiving RHC increase by a factor of 1.6.  

For primary disease category of other, the coefficient is -0.8848958, which is interpreted as the expected change in log odds for a one-unit increase in the any other disease. We can say that for a one unit increase in any other disease, the odds of receiving RHC increase by a factor of 0.412.

(ignore for now)
With the linear model, we can predict whether or not a critically ill patient will use RHC using the pre RHC variables. However, we should be careful in interpreting that these variables have a causal effect of RHC as there might be confounders that affect both the outcome and the variables. In this case, the causal assumption that the outcome and variables should be independent given confounders, will be violated. For example, economic status can affect both the use of RHC and the pre RHC health indicators, as rich people tend to have better health and they can afford to get an RHC while the others are not. Also, age is another major confounder, as elderlies tend to have worse health status and they might be too old and unstable to get a surgery for RHC. Living environment can also be a confounder, as one who lives in an area without access to big hospitals facilitated for RHC can affect the use of RHC and the living environmnet can also affect the general health status. 













